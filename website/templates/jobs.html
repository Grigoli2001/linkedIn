<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="{{url_for('static', filename='style/job-card.css')}}"
    />
    <link
      rel="stylesheet"
      href="{{url_for('static', filename='style/main-navbar.css')}}"
    />
    <script
      src="https://kit.fontawesome.com/5eabe89611.js"
      crossorigin="anonymous"
    ></script>
    <title>Jobs</title>
  </head>
  <body>
    {%include 'navbar.html'%}

    <div class="content-wrapper">
      <div class="content-leftside">
        <div class="leftside-content-wrapper">
          <div class="profile-box">
            <div class="cover-pic">
              <img
                src="https://images.unsplash.com/photo-1628427634386-7a6e2d1f55ac?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1932&q=80"
                alt=""
              />
            </div>
            <div class="blankspace"></div>
            <img src="{{current_user.profile_pic}}" alt="" />
          </div>
          <div class="description">
            <div class="fullname">{{current_user.fullname}}</div>
            <div class="title">{{current_user.description}}</div>
          </div>
          <div class="profile-viewers">
            <span>Profile viewers</span>
            <span>38</span>
          </div>
          <div onclick="location.assign('/my_items')" class="my-items">
            <i class="fa-solid fa-bookmark"></i>
            <span>My items</span>
          </div>
        </div>
      </div>
      <div class="main-content">
        {% for job in jobs %}
        <div class="job-card">
          <div class="card-content-wrapper">
            <div
              class="company-logo"
              onclick="displayApplication(
              '{{job._id}}',
              '{{job.job_title}}',
              '{{job.job_description}}',
              '{{job.company}}',
              '{{job.job_type}}',
              '{{job.location}}',
              '{{job.salary}}',
              '{{job.application_deadline}}',
              '{{job.application_process}}',
              {{job.job_requirements}},
              {{job.desired_skills}},
              '{{job.date_posted}}',
              '{{job.contact_information}}',
              '{{job.posted_by}}',
              '{{job.logo}}',
              '{{job.application_count}}',
              '{{job.job_status}}',
              '{{job.job_category}}'
            )"
            >
              <img src="{{job.logo}}" />
            </div>
            <div
              class="job-card-content"
              onclick="displayApplication(
              '{{job._id}}',
              '{{job.job_title}}',
              '{{job.job_description}}',
              '{{job.company}}',
              '{{job.job_type}}',
              '{{job.location}}',
              '{{job.salary}}',
              '{{job.application_deadline}}',
              '{{job.application_process}}',
              {{job.job_requirements}},
              {{job.desired_skills}},
              '{{job.date_posted}}',
              '{{job.contact_information}}',
              '{{job.posted_by}}',
              '{{job.logo}}',
              '{{job.application_count}}',
              '{{job.job_status}}',
              '{{job.job_category}}'
            )"
            >
              <div class="title-company">
                <span class="card-title"
                  >{{job.job_title}} - {{job.job_type}}</span
                >
                <span>{{job.company}}</span>
              </div>
              <span class="location">{{job.location}}</span>
              <span class="location">{{job.salary}}</span>
            </div>
            <div class="icons">
              <div class="save" onclick="saveJob('{{job._id}}')">
                {%if job.saved %}
                <i id="{{job._id}}" class="fa-solid fa-bookmark"></i>
                {%else%}
                <i id="{{job._id}}" class="fa-regular fa-bookmark"></i>
                {%endif%}
              </div>
            </div>
          </div>
          <div class="card-footer">
            <span>{{job.date_posted}}</span>
            <span>{{job.application_count}} Applicants</span>
          </div>
        </div>
        {%endfor%}
      </div>
      <div class="content-rightside-job">
        <div class="application-container"></div>
      </div>
    </div>

    <script>
      function saveJob(jobId) {
        const icon = document.getElementById(jobId);

        // Toggle the 'fa-regular' and 'fa-solid' classes
        icon.classList.toggle("fa-regular");
        icon.classList.toggle("fa-solid");

        const xhr = new XMLHttpRequest();
        if (icon.classList.contains("fa-solid")) {
          xhr.open("POST", "/save_item/" + jobId);
        } else {
          xhr.open("POST", "/delete_item/" + jobId);
        }
        xhr.send();

        // Add a class to trigger the CSS animation
        icon.classList.add("ticked-animation");

        // Remove the animation class after the animation is complete
        icon.addEventListener("animationend", () => {
          icon.classList.remove("ticked-animation");
        });

        console.log("Toggled");
      }

      function displayApplication(
        jobId,
        jobTitle,
        job_description,
        company,
        job_type,
        location,
        salary,
        application_deadline,
        application_process,
        requirements,
        skills,
        date_posted,
        contact_information,
        posted_by,
        logo,
        application_count,
        status,
        category
      ) {
        const applicationContainer = document.querySelector(
          ".application-container"
        );
        const mainContent = document.querySelector(".content-rightside-job");
        // Iterate through the properties of the requirementsObject
        const requirementsList = Object.keys(requirements)
          .map((key) => `<li>${key}: ${requirements[key]}</li>`)
          .join("");
        applicationContainer.style.opacity = 0;
        mainContent.style.flex = 1;

        const skillsList = Object.keys(skills)
          .map((key) => `${skills[key]}  `)
          .join("");
        console.log(status);
        const applicationHTML = `
              <div class="job-application">
                <div class="job-application-header">
                  <h2 class="job-title-h">${jobTitle}</h2>
                  <div class="location-job">
                    <span>${company};</span>
                    <span>${location};</span>
                    <span>Category: ${category};</span>
                    <span>Posted on: ${date_posted};</span>
                    <span>${application_count} Applicants</span>
                  </div>
                </div>
              <div class="job-application-info">
                <div class="job-detail">
                  <i class="fa-solid fa-suitcase"></i>
                  <span>${location}</span>
                  <span>${job_type}</span>
                </div>
                <div class="job-detail">
                  <i class="fa-solid fa-thumbs-up"></i>
                  <span>Skills: ${skillsList}</span>
                </div>
                <div class="job-detail">
                  <i ${
                    status == "Open"
                      ? "class='fa-solid fa-envelope-open' style='color: green'"
                      : "class='fa-solid fa-envelope' style='color: red'"
                  }></i>
                  <span>Status: ${status == "Open" ? "Open" : "Closed"}</span>
                </div>
              </div>
              <div class="job-application-action">
                <button class="apply-btn">Apply</button>
                <button class="save-btn" onclick="saveJob('${jobId}')">Save</button>
              </div>
              <div class="job-application-content">
                <h4>About the job</h4>
                <p>${job_description}</p>
              </div>
                <h4>Requirements:</h4>
                <ul>
                  ${requirementsList}
                </ul>
                <h4>Application Instructions:</h4>
                <p>${application_process}</p>
              </div>
            `;
        // Set the innerHTML of the application container to display the job application
        applicationContainer.innerHTML = applicationHTML;
        setTimeout(() => {
          console.log("Timeout");
          applicationContainer.style.opacity = 1;
          mainContent.style.flex = 1.5;
        }, 200);
      }
    </script>
  </body>
</html>
